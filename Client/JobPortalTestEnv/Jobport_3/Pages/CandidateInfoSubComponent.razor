@inject HttpClient httpClient
@inject State State
@inject IJSRuntime jsRuntime
@inject NavigationManager NavManager
@using XebecPortal.Client.JobPortalTestEnv.Models
@using XebecPortal.Shared.Security

<style>
    .profile-wrapper {
        width: 100%;
        height: 100%;
        background-color: lightgray; 
        flex-grow: 1;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        overflow: auto;
        min-height: 0;
    }


.profile-wrapper::-webkit-scrollbar {
  width: 0.5em;
}
 
.profile-wrapper::-webkit-scrollbar-track {
  box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.3);
}
 
.profile-wrapper::-webkit-scrollbar-thumb {
  background-color: #a9baba;
}

    .left {
        width: 45%;
        margin: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-end;
    }

    .right {
        width: 50%;
        height: 100%;
        margin: auto;
        position: -webkit-sticky;
        position: sticky;
        top: 0;        
    }

    .content {
        width: 100%;
        background-color: #fff;
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
        max-width: 550px;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;        
    }

    .right .content
    {
        max-width: 600px;
        max-height: 400px; 
        padding: 15px;
        font-size: 15px;  
        overflow-y: auto;
    }

.right .content::-webkit-scrollbar {
  width: 0;
}

.right .content::-webkit-scrollbar-thumb {
  background-color: #fff;  
}

    .right .content ul
    {
        margin: 5px 0 0 0;
        padding: 0;
    }

    .right .content ul li{
        list-style: none;
        margin-bottom: 10px;
        font-weight: bold;
        color: green;
    }

    .document-type
    {
        font-size: 13px;
        margin-left: 10px;        
    }

    .personal {
        display: flex;
        flex-direction: column;
    }

    h5 {
        font-weight: bold;
    }

    .top {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid lightgray;
    }

    .bottom {
        position: relative;
        display: flex;
        padding: 10px 5px;
        margin: 0.8rem 0;
    }

    .image img {
        max-width: 180px;
        max-height: 180px;
    }

    .details {
        width: 100%;
        height: inherit;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        padding: 0 10px;
    }

    .details span {
        font-size: 14px;
        margin-bottom: 5px;
        letter-spacing: 0.3px;
    }

    .education .details {
        padding: 0;
    }

    .line
    {
        width: 100%;
        height: 1px;
        background-color: #cad2dd;
        margin: 1rem auto;
    }

    .btn-inline
    {
        display: flex;
    }

    .icon-btn{
        cursor:pointer;
        transition:0.3s;
    }

    .icon-btn:hover
    {
        transform:scale(110%);
    }

    .icon-btn:active
    {
        transform:scale(90%);
    }


/*loading test*/
.spinner {
    border: 16px solid silver;
    border-top: 16px solid #337AB7;
    border-radius: 50%;
    width: 80px;
    height: 80px;
    animation: spin 700ms linear infinite;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    position: absolute;
    z-index: 20;
}

@@keyframes spin {
    0% {
        transform: rotate(0deg)
    }

    100% {
        transform: rotate(360deg)
    }
}

.search-bar-container
{
    width: 100%;
    height: 80px;
    background-color: rgba(108, 133, 163, 0.5);
    margin-top: 5px;
    display: flex;
    justify-content: center;
    align-items: center;,\

}

.search-bar-container .searchbar{
    width: 100%;
    display: flex;
    justify-content: space-evenly;
    align-items: center;    
}

.search-bar-container .searchbar input{
    font-size: 14px;
    margin-left: 5px;
    border-radius: 5px;
    padding: 4px 10px;
    outline: none;
    border: 0.3px solid #6c85a3;
}

.search-bar-container .searchbar select{
    font-size: 14px;
    margin-left: 5px;
    border-radius: 5px;
    padding: 4px 12px;
    outline: none;
    border: 0.3px solid #6c85a3;
}

.left-search
{
    display: flex;
    margin-top: 22px;
}
.personal{
    border: 0.5px solid #fff;
    transition: all 0.5s ease;
}
.personal:hover{
    border: 0.5px solid #6c85a3;
}


.header-container{
    width: 100%;
    display: flex;
    justify-content: space-between;
}


</style>



<div class="search-bar-container">

  

</div>


<div class="profile-wrapper">
   
    <div class="left">    
       

      <div class="personal content">

            
        
      </div>
       

    </div>

    <div class="right">
   
        <div class="content">

            
        
        </div>

    </div>
   

</div>

@code
{
    public ApplicationPhaseHelper TempPhaseHelper { get; set; } = new ApplicationPhaseHelper();


    private List<AppUser> RealCandidates { get; set; } = new List<AppUser>();

    private AppUser RealUser { get; set; }
    private List<PersonalInformation> RealCandidatesInfo { get; set; }
    private PersonalInformation RealUserPersonalInfo { get; set; }
    private List<WorkHistory> RealUserExperience { get; set; }
    private List<Education> RealUserEducation { get; set; }
    private List<ApplicationPhase> applicationPhases { get; set; }
    private List<ApplicationPhaseHelper> applicationPhaseHelpers { get; set; }
    private List<Status> statuses { get; set; }
    private ApplicationPhaseHelper displayAPH { get; set; }

    [Parameter]
    public string JobId { get; set; }

    #region Component LifeCycles
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        try
        {
            RealCandidates = await httpClient.GetFromJsonAsync<List<AppUser>>($"api/CandidateTest/?JobId={JobId}");
            applicationPhases = await httpClient.GetFromJsonAsync<List<ApplicationPhase>>("api/ApplicationPhase");
            applicationPhaseHelpers = await httpClient.GetFromJsonAsync<List<ApplicationPhaseHelper>>("api/ApplicationPhaseHelper");
            statuses = await httpClient.GetFromJsonAsync<List<Status>>("api/Status");

            if (RealCandidates.Count > 0)
            {
                Console.WriteLine("we made it here");
                RealCandidatesInfo = await httpClient.GetFromJsonAsync<List<PersonalInformation>>($"api/PersonalInformation/candidates/{JobId}");
            }
            if (RealCandidatesInfo.Count > 0)
            {
                RealUserPersonalInfo = RealCandidatesInfo[0];
                @* CurrentCandidate = Candidates[0]; *@
            }

        }
        catch (Exception ex)
        {
            RealCandidates = new List<AppUser>();
            RealCandidatesInfo = new List<PersonalInformation>();
        }

    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await jsRuntime.InvokeVoidAsync("initialize");  //Calls the initialize function from the javascript file.
        }
        @* if (Candidates.Count > 0)
        {
            CurrentCandidate = Candidates[0];
        } *@
    }
    #endregion Component LifeCycles

    private void ChangeCurrent(PersonalInformation newcandidate)
    {
        RealUserPersonalInfo = newcandidate;
    }

    #region Searching and Filtering
    //Search query parameters
    private string SearchTerm { get; set; } = string.Empty;
    private string DisabilityFilter { get; set; } = string.Empty;
    private string EthnicFilter { get; set; } = string.Empty;
    private string GenderFilter { get; set; } = string.Empty;

    //boolean filtering checkers
    private bool EthnicFilterApplied = false;
    private bool GenderFilterApplied = false;
    private bool DisabilityFilterApplied = false;

    private List<PersonalInformation> SearchedCandidates { get; set; } = new List<PersonalInformation>();

    private void onValChanged(Microsoft.AspNetCore.Components.ChangeEventArgs args)
    {
        switch (args.Value.ToString())
        {
            case "Black":
                EthnicFilter = args.Value.ToString();
                EthnicFilterApplied = true;
                break;
            case "White":
                EthnicFilter = args.Value.ToString();
                EthnicFilterApplied = true;
                break;
            case "Indian":
                EthnicFilter = args.Value.ToString();
                EthnicFilterApplied = true;
                break;
            case "Coloured":
                EthnicFilter = args.Value.ToString();
                EthnicFilterApplied = true;
                break;
            case "Male":
                GenderFilter = args.Value.ToString();
                GenderFilterApplied = true;
                break;
            case "Female":
                GenderFilter = args.Value.ToString();
                GenderFilterApplied = true;
                break;
            case "disabled":
                DisabilityFilter = args.Value.ToString();
                DisabilityFilterApplied = true;
                break;
            case "abled":
                DisabilityFilter = args.Value.ToString();
                DisabilityFilterApplied = true;
                break;
            default:
                break;
        }
        SearchEvent();
    }

    //Clear Methods
    private void ClearEthnic()
    {
        EthnicFilterApplied = false;
        EthnicFilter = string.Empty;
        SearchEvent();
    }
    private void ClearGender()
    {
        GenderFilterApplied = false;
        GenderFilter = string.Empty;
        SearchEvent();
    }
    private void ClearDisability()
    {
        DisabilityFilterApplied = false;
        DisabilityFilter = string.Empty;
        SearchEvent();
    }

    private void RealSearch()
    {

        SearchEvent();

    }

    private async Task<List<PersonalInformation>> SearchEvent()
    {

        try
        {
            RealCandidates = await httpClient.GetFromJsonAsync<List<AppUser>>($"api/CandidateTest/?JobId={int.Parse(JobId)}");
        }
        catch (Exception ex)
        {
            RealCandidates = new List<AppUser>();
        }

        if (RealCandidates.Count > 0)
        {
            SearchedCandidates = await httpClient.GetFromJsonAsync<List<PersonalInformation>>($"api/CandidateTest/candidates/?Job={JobId}&SearchQuery={SearchTerm}&ethnicityFiler={EthnicFilter}&GenderFilter={GenderFilter}&disabilityFilter={DisabilityFilter}");
        }

        if (SearchedCandidates.Count > 0)
        {
            RealUserPersonalInfo = SearchedCandidates[0];
        }
        RealCandidatesInfo = SearchedCandidates;
        InvokeAsync(StateHasChanged);
        return RealCandidatesInfo;
    }

    #endregion

    //==============================================================================================================================================================

    //TestModels
    @* private static List<CandidateTest> DisplayItems = Candidates;

    private CandidateTest CurrentCandidate = new CandidateTest();

    //Data
    private static List<CandidateTest> Candidates = new List<CandidateTest>
{

    new CandidateTest
    {
        Id = 1,
        Name = "Johnathan Snow",
        JobAppliedFor = "Developer",
        YearsOfExp = 2,
        ExtraInfo = "Lorem ipsum dolor sit amet consectetur adipisicing elit. Iure laborum nesciunt unde iusto quas rerumores quaerat eum velit totam!"

    },

    new CandidateTest
    {
        Id = 2,
        Name = "Edward Stark",
        JobAppliedFor = "Lawyer",
        YearsOfExp = 8,
        ExtraInfo = "Lorem ipsum dolor sit amet consectetur adipisicing elit. Iure laborum nesciunt unde iusto quas rerumores quaerat eum velit totam!"

    },

    new CandidateTest
    {
        Id = 3,
        Name = "Peter Parker",
        JobAppliedFor = "Developer",
        YearsOfExp = 1,
        ExtraInfo = "Lorem ipsum dolor sit amet consectetur adipisicing elit. Iure laborum nesciunt unde iusto quas rerumores quaerat eum velit totam!"

    },

    new CandidateTest
    {
        Id = 4,
        Name = "Bruce Banner",
        JobAppliedFor = "Cloud Engineer",
        YearsOfExp = 5,
        ExtraInfo = "Lorem ipsum dolor sit amet consectetur adipisicing elit. Iure laborum nesciunt unde iusto quas rerumores quaerat eum velit totam!"

    }

    }; *@

   
}